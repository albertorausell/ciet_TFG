
{% extends "trainer_app/templates/base_trainer.html" %}
{% load static %}


{% block content %}


<div style="margin: 5%;">
        <div class="row" style="margin-top: 30;">
            <div class="col-2" style="text-align: left;">
                <div class="row">
                    <div class="col">
                        <a class="btn btn-primary" style="font-size: 150%" href="{% url 'objectives' id=cap_id %}">
                            ðŸ¡ 
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label id="label"></label>
                        <hr>
                        <div>
                            <i><u>Capability plan:</u></i>
                        </div>
                        <div style="margin-left: 10;">
                            <i>{{cap_name}}</i>
                        </div>
                        <br>
                        <br>
                        <div>
                            <i><u>Objectives:</u></i>
                        </div>
                        <div class="list-group" style="height: 80%; overflow: auto; margin-top: 10;" id="obj_list" role="tablist">
                            {% for objective in cap_obj %}
                                <a style="word-wrap: break-word;" class="list-group-item list-group-item-action list-group-item-primary" data-toggle="list" href="#" role="tab" onclick="pressObjective('{{ objective.pk }}')">
                                    {{objective.name}}
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <input id="currentObjective" value="" hidden>
            <input id="currentContent" value="" hidden>
            <div class="col" style="height: 80%; width: 50%;">
                <div style="height: 80%; text-align: center;border-style: solid;border-radius: 25px;border-color: lightgray; border-width: thin;">
                    <div class="row" style="height: 100%;">
                        <div class="col-2 border-right" style="padding-left: 30;">
                            <br>
                            <a href="#" type="button" data-toggle="modal" data-target="#addContent">
                                <span class="fa-stack fa-lg">
                                  <i  style="color: dimgrey;" class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                            <br>
                            <br>
                            <div class="list-group" id="contents_list" role="tablist" style="border-radius: 5px;height: 75%; overflow: auto; display: block;">
                                
                            </div>
                            <ul id="contents_ul" hidden>
                                {% for objective in obj_cont %}
                                    {% for content in objective.contents %}
                                        <li >
                                            {{objective.cap_obj_pk}}:{{content.pk}}%{{content.name}}
                                        </li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col" style="height: 100%; width: 50%;">
                            <ul id="components_ul" hidden>
                                {% for content in cont_tech %}
                                    {% for component in content.media_comps %}
                                    <li >
                                        {{content.cont.pk}}:{{content.cont.name}}
                                    </li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                            <div style="position: relative; height: 100%; overflow: auto; display: block;overflow-x: hidden;">
                                <div class="row">
                                    <div class="col-2" style="padding-right: 0%;">
                                        <div class="dropdown" style="display: inline;">
                                            <button class="btn btn-secondary dropdown-toggle" style="margin-top: 25; width: 100%;" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                Add
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <a class="dropdown-item" style="cursor: pointer;" type="button" data-toggle="modal" data-target="#addText">Text</a>
                                                <a class="dropdown-item" style="cursor: pointer;" type="button" data-toggle="modal" data-target="#addImage">Image</a>
                                                <a class="dropdown-item" style="cursor: pointer;" type="button" data-toggle="modal" data-target="#addVideo">Video</a>
                                                <a class="dropdown-item" style="cursor: pointer;" type="button" data-toggle="modal" data-target="#addDocument">Document</a>
                                                <a class="dropdown-item" style="cursor: pointer;" type="button" data-toggle="modal" data-target="#addLink">Link</a>
                                                    <a class="dropdown-item" style="cursor: pointer;" type="button" data-toggle="modal" data-target="#addGame">Game</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-2" style="padding-left: 0%;">
                                        <a class="btn btn-danger" style="margin-top: 25; color: white;" type="button" data-toggle="modal" data-target="#deleteContent">
                                            Delete
                                        </a>
                                    </div>
                                    <div class="col" style=" text-align: left;">
                                        <h1 style="font-family: Raleway; padding-right: 20%; height: 100%; margin-top: 20;" id="content_name"></h1>
                                        
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col" style="height: 600;">
                                        <div id="comp_list" style="position: relative; height: 90%; overflow: auto; display: block;overflow-x: hidden;">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>


<!-- The Add Modal -->
{% include 'capabilities/new_content.html' %}
{% include 'capabilities/new_component.html' %}
{% include 'capabilities/delete_content.html' %}

<script type="text/javascript">
    function quitActive(string) {
        let index = string.indexOf(' active');
        if (index > 0) {
            return string.substring(0, index) + string.substring(index + 7);
        } else {
            return string;
        }
    }
    
    function quitDisabled(string) {
        let index = string.indexOf(' disabled');
        if (index > 0) {
            return string.substring(0, index) + string.substring(index + 9);
        } else {
            return string;
        }
    }

    function addDisabled(string) {
        if (string.indexOf(' disabled') < 0) {
            return string + ' disabled';
        } else {
            return string;
        }
    }

    function getIdByOnClick(element){
        let click = element.onclick.toString();
        let par = click.indexOf("('");
        //click="function onclick(event) {pressObjective('2')}"
        let idO = click.substring(par + 2, click.indexOf("'", par + 2));
        return idO;
    }

    function pressIndexOfList(index, listId) {
        let list = document.getElementById(listId);
        if (list.getElementsByTagName("a").length > 0) {
            let id = getIdByOnClick(list.getElementsByTagName("a")[index]);
            if (listId == 'obj_list') {
                pressObjective(id);
            } else {
                pressContent(id);
            }
        }
    }

    function pressObjective(id) {
        let string_id = id + "";

        //FOR POST:
        document.getElementById("_c").value = id + "_c";
        //-----------------------
        let list = document.getElementById("obj_list").getElementsByTagName("a");
        for (let i = 0; i < list.length; i++) {
            const element = list[i];
            element.className = quitActive(element.className);
            idO = getIdByOnClick(element);
            if (idO == string_id) {
                document.getElementById("objManttext").value = i;
                document.getElementById("objMantimage").value = i;
                document.getElementById("objMantvideo").value = i;
                document.getElementById("objMantdocument").value = i;
                document.getElementById("objMantlink").value = i;
                document.getElementById("objMantgame").value = i;
                document.getElementById("currentContent").value = i;
                document.getElementById("objMantdel").value = i;
                document.getElementById("objMant").value = i;
                document.getElementById("currentObjective").value = i;
                element.className += " active";
            }
        }
        //----------PLACE CONTENTS-------------
        document.getElementById("comp_list").innerHTML = '<br>';
        document.getElementById("dropdownMenuButton").className = addDisabled(document.getElementById("dropdownMenuButton").className);
        let contents_li = document.getElementById("contents_ul").getElementsByTagName("li");
        let contents_list = document.getElementById("contents_list");
        contents_list.innerHTML = '';
        for (let i = 0; i < contents_li.length; i++) {
            const element = contents_li[i].innerText;
            const obj_pk = element.substring(0, element.indexOf(':')).trim();
            const cont_pk = element.substring(element.indexOf(':') + 1, element.indexOf('%'));
            if (id == obj_pk) {
                contents_list.innerHTML += `
                    <a href="#" style="word-wrap: break-word;" class="list-group-item list-group-item-action list-group-item-secondary" onclick="pressContent('${cont_pk}')" data-toggle="list" href="#" role="tab">
                        ${element.substring(element.indexOf('%') + 1)}
                        
                    </a>
                
                `;    
            //document.getElementById('label').innerText += '--' + element.substring(element.indexOf(':') + 1);
            }
        }  
        pressIndexOfList(0, 'contents_list');
    }

    function print(string){
        document.getElementById('label').innerText = string;
    }

    function getCurrentContent() {
        return document.getElementById("currentContent").value;
    }

    function getCurrentObjective() {
        return document.getElementById("currentObjective").value;
    }

    function pressContent(id) {
        let string_id = id + "";

        //FOR POST:
        document.getElementById("textin").value = id + "&txt";
        document.getElementById("imagein").value = id + "&img";
        document.getElementById("videoin").value = id + "&vid";
        document.getElementById("documentin").value = id + "&doc";
        document.getElementById("linkin").value = id + "&lnk";
        document.getElementById("gamein").value = id + "&gme";

        document.getElementById("idContdel").value = string_id;
        //----------------------------------
        let add = document.getElementById("dropdownMenuButton");
        add.className = quitDisabled(add.className);
        let list = document.getElementById("contents_list").getElementsByTagName("a");
        for (let i = 0; i < list.length; i++) {
            const element = list[i];
            element.className = quitActive(element.className);
            idO = getIdByOnClick(element);
            if (idO == string_id) {
                document.getElementById("contManttext").value = i;
                document.getElementById("contMantimage").value = i;
                document.getElementById("contMantvideo").value = i;
                document.getElementById("contMantdocument").value = i;
                document.getElementById("contMantlink").value = i;
                document.getElementById("contMantgame").value = i;
                document.getElementById("contMantdel").value = i;
                document.getElementById("contMant").value = i;
                document.getElementById("currentContent").value = i;
                element.className += " active";
                //-----
                document.getElementById("content_name").textContent = element.textContent;
            }
        }
        //----------PLACE COMPONENTS-------------
        let components_list = document.getElementById("comp_list");
        components_list.innerHTML = '<br>';
        let length = '{{cont_tech|length}}', contId;
        let comps = [];
        {% for cont in cont_tech %}
            contId = '{{cont.cont.pk}}'
            if (contId == id) {
                {% for comp in cont.media_comps %}
                    if ('{{comp.type}}' == 'img' ||
                        '{{comp.type}}' == 'vid' ||
                        '{{comp.type}}' == 'doc') {
                        comps.push(['{{comp.type}}', '{{comp.value.url}}', '{{comp.pk}}', '{{comp.description}}']);
                    } else {
                        comps.push(['{{comp.type}}', '{{comp.value}}', '{{comp.pk}}', '{{comp.description}}']);
                    }
                {% endfor %}
            }
        {% endfor %}

        for (let i = 0; i < comps.length; i++) {
            const element = comps[i];
            switch (element[0]) {
                case 'txt':
                    components_list.innerHTML += `
                        <p>
                            <form action="{% url 'deleteComponent' %}" method="POST">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col" style="text-align: justify; width: 50%; word-wrap: break-word">
                                        ${element[1]}
                                    </div>
                                    <div class="col-1" >
                                        <input name="contPos" value="${getCurrentContent()}" hidden>
                                        <input name="objPos" value="${getCurrentObjective()}" hidden>
                                        <input name="idCap" value="{{cap_id}}" hidden>
                                        <input name="compId" value="${element[2]}" hidden>
                                        <input class="btn btn-link close" type="submit" style="font-weight: bold;font-size:30;border-radius: 25px; color: red; width: 60; text-decoration: none;" name="delete" value="âœ˜">
                                    </div>
                                </div>
                            </form>
                        </p>
                        <hr style="width:25%;margin-top: 25px;margin-bottom: 25px;border-radius: 7px 7px 7px 7px; background: lightgray;height: 5px;">
                    `
                    break;
            
                case 'img':
                    components_list.innerHTML += `
                    
                    <form action="{% url 'deleteComponent' %}" method="POST">
                        {% csrf_token %}
                        <div style="position:relative; left:10%">
                            <p class="row">
                                <img style="border-radius: 20px;" class="img-fluid" src="${element[1]}" width="75%" height="75%">
                                <span>
                                    <input name="contPos" value="${getCurrentContent()}" hidden>
                                    <input name="objPos" value="${getCurrentObjective()}" hidden>
                                    <input name="idCap" value="{{cap_id}}" hidden>
                                    <input name="compId" value="${element[2]}" hidden>
                                    <a class="fa fa-eye fa-2x" style="text-decoration:none;cursor: pointer; color: blue; display:block; margin-left:5" href="${element[1]}" target="_blank"></a>
                                    <input class="btn btn-link close" type="submit" style="font-weight: bold;font-size:30;border-radius: 25px; color: red; width: 60; text-decoration: none;" name="delete" value="âœ˜">
                                    
                                </span>
                            </p>
                        </div>
                        <div class="row">
                            <div class="col-1">
                            </div>
                            <div class="col" style="text-align: justify;word-wrap: break-word">
                                <p class="border-left" style="color: #808080; padding-left:10;padding-right:100;">
                                    <i>${element[3]}</i>
                                </p>
                            </div>
                        </div>
                    </form>
                    <hr style="width:25%;margin-top: 25px;margin-bottom: 25px;border-radius: 7px 7px 7px 7px; background: lightgray;height: 5px;">
                    `;
                    break;
            
                case 'vid':
                    components_list.innerHTML += `
                    <form action="{% url 'deleteComponent' %}" method="POST">
                        {% csrf_token %}
                        <div style="text-align:center">
                            <video width="70%" height="70%" controls>
                                <source src="${element[1]}" type="video/mp4">
                            </video>
                            <span>
                                <input name="contPos" value="${getCurrentContent()}" hidden>
                                <input name="objPos" value="${getCurrentObjective()}" hidden>
                                <input name="idCap" value="{{cap_id}}" hidden>
                                <input name="compId" value="${element[2]}" hidden>
                                <input class="btn btn-link close" type="submit" style="font-weight: bold;font-size:30;border-radius: 25px; color: red; width: 60; text-decoration: none;" name="delete" value="âœ˜">
                            </span>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-1">
                            </div>
                            <div class="col" style="text-align: justify;word-wrap: break-word">
                                <p class="border-left" style="color: #808080; padding-left:10;padding-right:100;">
                                    <i>${element[3]}</i>
                                </p>
                            </div>
                        </div>
                    </form>
                    <hr style="width:25%;margin-top: 25px;margin-bottom: 25px;border-radius: 7px 7px 7px 7px; background: lightgray;height: 5px;">
                    `
                    break;
        
                case 'doc':
                    let string = element[1];
                    let fileName = string.substring(string.indexOf('/media/') + 7);
                    components_list.innerHTML += `
                        <p>
                            <form action="{% url 'deleteComponent' %}" method="POST">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col" style="text-align: left;width: 50%; word-wrap: break-word">
                                        <a href="${element[1]}" target="_blank">
                                            <i class="fa fa-file fa-2x" aria-hidden="true"></i>
                                            ${fileName}
                                        </a>
                                        <input name="contPos" value="${getCurrentContent()}" hidden>
                                        <input name="objPos" value="${getCurrentObjective()}" hidden>
                                        <input name="idCap" value="{{cap_id}}" hidden>
                                        <input name="compId" value="${element[2]}" hidden>
                                        <input class="btn btn-link close" type="submit" style="font-weight: bold;font-size:30;border-radius: 25px; color: red; width: 60; text-decoration: none;" name="delete" value="âœ˜">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-1">
                                    </div>
                                    <div class="col" style="text-align: justify;word-wrap: break-word">
                                        <p class="border-left" style="color: #808080; padding-left:10;padding-right:100;">
                                            <i>${element[3]}</i>
                                        </p>
                                    </div>
                                </div>
                            </form>
                        </p>
                        <hr style="width:25%;margin-top: 25px;margin-bottom: 25px;border-radius: 7px 7px 7px 7px; background: lightgray;height: 5px;">
                    `;
                    break;
            
                case 'lnk':
                    components_list.innerHTML += `
                        <p>
                            <form action="{% url 'deleteComponent' %}" method="POST">
                            {% csrf_token %}
                                <div class="row">
                                    <div class="col" style="text-align: left;width: 50%; word-wrap: break-word">
                                        <a href="${element[1]}" target="_blank">
                                            <i class="fa fa-link fa-2x" aria-hidden="true"></i>
                                            <p style="display:inline">
                                                ${element[1]}
                                            </p>
                                        </a>
                                        <input name="contPos" value="${getCurrentContent()}" hidden>
                                        <input name="objPos" value="${getCurrentObjective()}" hidden>
                                        <input name="idCap" value="{{cap_id}}" hidden>
                                        <input name="compId" value="${element[2]}" hidden>
                                        <input class="btn btn-link close" type="submit" style="font-weight: bold;font-size:30;border-radius: 25px; color: red; width: 60; text-decoration: none;" name="delete" value="âœ˜">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-1">
                                    </div>
                                    <div class="col" style="text-align: justify;word-wrap: break-word">
                                        <p class="border-left" style="color: #808080; padding-left:10;padding-right:100;">
                                            <i>${element[3]}</i>
                                        </p>
                                    </div>
                                </div>
                            </form>
                        </p>
                        <hr style="width:25%;margin-top: 25px;margin-bottom: 25px;border-radius: 7px 7px 7px 7px; background: lightgray;height: 5px;">
                    `
                    break;
        
                case 'gme':
                components_list.innerHTML += `
                        <p>
                            <form action="{% url 'deleteComponent' %}" method="POST">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col" style="text-align: left;width: 50%; word-wrap: break-word">
                                        <a href="${element[1]}" target="_blank">
                                            <i class="fa fa-gamepad fa-2x" aria-hidden="true"></i>
                                            <p style="display:inline">
                                                ${element[1]}
                                            </p>
                                        </a>
                                        <input name="contPos" value="${getCurrentContent()}" hidden>
                                        <input name="objPos" value="${getCurrentObjective()}" hidden>
                                        <input name="idCap" value="{{cap_id}}" hidden>
                                        <input name="compId" value="${element[2]}" hidden>
                                        <input class="btn btn-link close" type="submit" style="font-weight: bold;font-size:30;border-radius: 25px; color: red; width: 60; text-decoration: none;" name="delete" value="âœ˜">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-1">
                                    </div>
                                    <div class="col" style="text-align: justify;word-wrap: break-word">
                                        <p class="border-left" style="color: #808080; padding-left:10;padding-right:100;">
                                            <i>${element[3]}</i>
                                        </p>
                                    </div>
                                </div>
                            </form>
                        </p>
                        <hr style="width:25%;margin-top: 25px;margin-bottom: 25px;border-radius: 7px 7px 7px 7px; background: lightgray;height: 5px;">
                    `
                    break;
            
                default:
                    break;
            }
        }
       
    }

</script>
<script>
    pressIndexOfList('{{obj_pos}}', 'obj_list');
    pressIndexOfList('{{cont_pos}}', 'contents_list');
</script>



{% endblock %}